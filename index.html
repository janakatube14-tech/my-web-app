<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Art Gallery Order Management</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <button id="menuToggle" class="menu-toggle" aria-label="Toggle Menu">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <div class="theme-toggle-container">
        <button id="themeToggle" class="theme-toggle">üåô</button>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="logo-container">
            <div class="logo-circle">
                üé®
            </div>
            <h2>Art Gallery</h2>
        </div>
        
        <nav>
            <a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">
                <span class="nav-icon">üìä</span>
                <span>Dashboard</span>
            </a>
            <a href="#add-order" class="nav-link" onclick="showSection('add-order'); document.getElementById('orderForm').reset(); document.getElementById('quantity').value = 1; updatePrice();">
                <span class="nav-icon">‚ûï</span>
                <span>Add New Order</span>
            </a>
            <a href="#need-deliver" class="nav-link" onclick="showSection('need-deliver')">
                <span class="nav-icon">üì¶</span>
                <span>Need to Deliver</span>
            </a>
            <a href="#dispatched" class="nav-link" onclick="showSection('dispatched')">
                <span class="nav-icon">üöö</span>
                <span>Dispatched</span>
            </a>
            <a href="#delivered" class="nav-link" onclick="showSection('delivered')">
                <span class="nav-icon">‚úÖ</span>
                <span>Delivered</span>
            </a>
            <a href="#refund" class="nav-link" onclick="showSection('refund')">
                <span class="nav-icon">‚Ü©Ô∏è</span>
                <span>Refund</span>
            </a>
            <a href="#expenses" class="nav-link" onclick="showSection('expenses')">
                <span class="nav-icon">üí∏</span>
                <span>Other Expenses</span>
            </a>
            <a href="#analytics" class="nav-link" onclick="showSection('analytics')">
                <span class="nav-icon">üìà</span>
                <span>Sales Analytics</span>
            </a>
        </nav>
    </div>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="main-content">
        
        <section id="dashboard" class="section active">
            <header class="section-header">
                <h1>Dashboard</h1>
                <div class="month-selector">
                    <input type="month" id="monthFilter" onchange="filterByMonth()">
                    <button onclick="clearMonthFilter()" class="btn-secondary">Clear Filter</button>
                </div>
            </header>
            <div class="dashboard-cards">
                <div class="card card-revenue">
                    <h3>Total Revenue</h3>
                    <p class="stat-value" id="totalRevenue">Loading...</p>
                </div>
                <div class="card card-profit">
                    <h3>Net Profit</h3>
                    <p class="stat-value" id="netProfit">Loading...</p>
                </div>
                <div class="card card-orders">
                    <h3>Total Orders</h3>
                    <p class="stat-value" id="totalOrders">Loading...</p>
                </div>
                <div class="card card-pending">
                    <h3>Pending Orders</h3>
                    <p class="stat-value" id="pendingOrders">Loading...</p>
                </div>
                <div class="card card-cost">
                    <h3>Total Frame Cost</h3>
                    <p class="stat-value" id="totalFrameCost">Loading...</p>
                </div>
                <div class="card card-expense">
                    <h3>Total Expenses</h3>
                    <p class="stat-value" id="totalExpenses">Loading...</p>
                </div>
            </div>
        </section>

        <section id="add-order" class="section">
            <header class="section-header">
                <h1>Add New Order</h1>
            </header>
            <form id="orderForm" class="order-form">
                <div class="form-section">
                    <h2>Order Details</h2>
                    <div class="form-row">
                        <label for="orderDate">Order Date:</label>
                        <input type="date" id="orderDate" value="" required>
                    </div>
                    <div class="form-row">
                        <label for="orderNumber">Order #:</label>
                        <input type="text" id="orderNumber" placeholder="e.g. 2024-001" required>
                    </div>
                    <div class="form-row">
                        <label for="orderStatus">Status:</label>
                        <select id="orderStatus" required>
                            <option value="Need to Deliver">Need to Deliver</option>
                            <option value="Dispatched">Dispatched</option>
                            <option value="Delivered">Delivered</option>
                            <option value="Refund">Refund</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="paymentMethod">Payment Method:</label>
                        <select id="paymentMethod" required>
                            <option value="Bank Deposit">Bank Deposit</option>
                            <option value="COD">Cash on Delivery (COD)</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="orderNotes">Notes:</label>
                        <textarea id="orderNotes" placeholder="Delivery instructions or special notes"></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Customer Details</h2>
                    <div class="form-row">
                        <label for="customerName">Customer Name:</label>
                        <input type="text" id="customerName" placeholder="Full Name" required>
                    </div>
                    <div class="form-row">
                        <label for="phone">Phone Number:</label>
                        <input type="tel" id="phone" placeholder="07XXXXXXXX" required>
                    </div>
                    <div class="form-row">
                        <label for="addressLine">Address Line:</label>
                        <input type="text" id="addressLine" placeholder="Street Address" required>
                    </div>
                    <div class="form-row">
                        <label for="city">City:</label>
                        <input type="text" id="city" placeholder="City" required>
                    </div>
                    <div class="form-row">
                        <label for="district">District:</label>
                        <input type="text" id="district" placeholder="District" required>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Item Details</h2>
                    <div class="form-row">
                        <label for="orderType">Item Type:</label>
                        <select id="orderType" onchange="toggleCustomPrice(); updatePrice();">
                            <option value="standard">Standard Frame Size</option>
                            <option value="custom">Custom Price/Size</option>
                        </select>
                    </div>

                    <div id="standardFrameSection">
                        <div class="form-row">
                            <label for="frameType">Frame Type:</label>
                            <select id="frameType" onchange="updatePrice()" required>
                                <option value="">Select Type</option>
                                <option value="Ply Mount">Ply Mount</option>
                                <option value="Glass Frame">Glass Frame</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label for="frameSize">Size:</label>
                            <select id="frameSize" onchange="updatePrice()" required>
                                <option value="">Select Size</option>
                                <option value="4x6">4x6</option>
                                <option value="6x8">6x8</option>
                                <option value="8x10">8x10</option>
                                <option value="8x12">8x12</option>
                                <option value="10x12">10x12</option>
                                <option value="10x15">10x15</option>
                                <option value="12x15">12x15</option>
                                <option value="12x18">12x18</option>
                                <option value="16x24">16x24</option>
                                <option value="20x30">20x30</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="customPriceSection" style="display: none;">
                         <div class="form-row">
                            <label for="customFrameDesc">Frame Description:</label>
                            <input type="text" id="customFrameDesc" placeholder="e.g. Custom Size 14x20" required>
                        </div>
                        <div class="form-row">
                            <label for="customPrice">Unit Price (Rs.):</label>
                            <input type="number" id="customPrice" step="0.01" min="0" required>
                        </div>
                         <div class="form-row">
                            <label for="customCost">Unit Cost (Rs.):</label>
                            <input type="number" id="customCost" step="0.01" min="0" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <label for="quantity">Quantity:</label>
                        <div class="quantity-control">
                            <button type="button" onclick="decrementQty()">-</button>
                            <input type="number" id="quantity" value="1" min="1" onchange="calculateTotal()" required>
                            <button type="button" onclick="incrementQty()">+</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <label for="unitPrice">Unit Price (Rs.):</label>
                        <input type="number" id="unitPrice" readonly>
                    </div>
                    <div class="form-row">
                        <label for="totalPrice">Total Price (Rs.):</label>
                        <input type="number" id="totalPrice" readonly>
                    </div>
                    <div class="form-row">
                        <label for="totalCost">Total Cost (Rs.):</label>
                        <input type="number" id="totalCost" readonly>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">Add Order</button>
                </div>
            </form>
            <script>document.getElementById('orderDate').value = new Date().toISOString().substring(0, 10);</script>
        </section>

        <section id="need-deliver" class="section">
            <header class="section-header">
                <h1>Orders: Need to Deliver</h1>
            </header>
            <div class="summary-card">
                <h3>Total Cost: <span class="cost-indicator">Rs. <span id="needDeliverCost">0.00</span></span></h3>
                <h3>Potential Profit: <span class="profit-indicator">Rs. <span id="needDeliverProfit">0.00</span></span></h3>
            </div>
            <div id="needDeliverList" class="order-list">
                </div>
        </section>

        <section id="dispatched" class="section">
            <header class="section-header">
                <h1>Orders: Dispatched</h1>
            </header>
            <div class="summary-card">
                <h3>Total Cost: <span class="cost-indicator">Rs. <span id="dispatchedCost">0.00</span></span></h3>
                <h3>Potential Profit: <span class="profit-indicator">Rs. <span id="dispatchedProfit">0.00</span></span></h3>
            </div>
            <div id="dispatchedList" class="order-list">
                </div>
        </section>

        <section id="delivered" class="section">
            <header class="section-header">
                <h1>Orders: Delivered</h1>
            </header>
            <div class="summary-card">
                <h3>Total Cost: <span class="cost-indicator">Rs. <span id="deliveredCost">0.00</span></span></h3>
                <h3>Actual Profit: <span class="profit-indicator">Rs. <span id="deliveredProfit">0.00</span></span></h3>
            </div>
            <div id="deliveredList" class="order-list">
                </div>
        </section>

        <section id="refund" class="section">
            <header class="section-header">
                <h1>Orders: Refund</h1>
            </header>
            <div class="summary-card">
                <h3>Total Loss: <span class="loss-indicator">Rs. <span id="refundProfit">0.00</span></span></h3>
                <h3>Total Original Cost: <span class="cost-indicator">Rs. <span id="refundCost">0.00</span></span></h3>
            </div>
            <div id="refundList" class="order-list">
                </div>
        </section>

        <section id="expenses" class="section">
            <header class="section-header">
                <h1>Other Expenses</h1>
            </header>
            <form id="expenseForm" class="expense-form">
                <div class="form-row">
                    <label for="expenseDate">Date:</label>
                    <input type="date" id="expenseDate" value="" required>
                </div>
                <div class="form-row">
                    <label for="expenseName">Expense Name:</label>
                    <input type="text" id="expenseName" placeholder="e.g. Delivery Fee, Art Supplies" required>
                </div>
                <div class="form-row">
                    <label for="expenseCost">Cost (Rs.):</label>
                    <input type="number" id="expenseCost" step="0.01" min="0" required>
                </div>
                <button type="submit" class="btn-primary">Add Expense</button>
            </form>
            <script>document.getElementById('expenseDate').value = new Date().toISOString().substring(0, 10);</script>
            <div class="expense-list-container">
                <h2>All Expenses</h2>
                <div id="expenseList" class="expense-list">
                    </div>
            </div>
        </section>

        <section id="analytics" class="section">
            <header class="section-header">
                <h1>Sales Analytics</h1>
            </header>
            <div class="analytics-summary">
                <div class="card card-top">
                    <h3>Most Sold Size</h3>
                    <p class="stat-value" id="topSize">N/A</p>
                    <small id="topSizeQty"></small>
                </div>
                <div class="card card-least">
                    <h3>Least Sold Size</h3>
                    <p class="stat-value" id="leastSize">N/A</p>
                    <small id="leastSizeQty"></small>
                </div>
                <div class="card card-district">
                    <h3>Top Selling District</h3>
                    <p class="stat-value" id="topDistrict">N/A</p>
                    <small id="topDistrictQty"></small>
                </div>
                <div class="card card-cod">
                    <h3>COD Orders</h3>
                    <p class="stat-value" id="codPercentage">0%</p>
                    <small id="codCount">0 orders</small>
                </div>
            </div>

            <div class="charts-container">
                <div class="chart-box">
                    <h3>Frame Size Sales Performance</h3>
                    <canvas id="frameSizeChart"></canvas>
                </div>

                <div class="chart-box small-chart">
                    <h3>Payment Methods</h3>
                    <canvas id="paymentChart"></canvas>
                </div>

                <div class="chart-box small-chart">
                    <h3>Top 5 Districts</h3>
                    <canvas id="districtChart"></canvas>
                </div>

                <div class="chart-box small-chart">
                    <h3>Frame Types</h3>
                    <canvas id="frameTypeChart"></canvas>
                </div>

                <div class="chart-box small-chart">
                    <h3>Top 5 Cities</h3>
                    <canvas id="cityChart"></canvas>
                </div>
            </div>
        </section>

    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <script>
      // ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è !!! ‡∂î‡∂∂‡∑ö Firebase Configuration !!! ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è
      // ‡∂î‡∂∂ ‡∂ë‡∑Ä‡∑ñ code ‡∂ë‡∂ö ‡∂¥‡∂∏‡∂´‡∂ö‡∑ä ‡∂∏‡∑ô‡∂≠‡∂± ‡∂≠‡∑í‡∂∫‡∑ô‡∂±‡∑Ä‡∑è
      const firebaseConfig = {
        apiKey: "AIzaSyD4cllOCGjbhqQtIpA33X1umdwAJSWtQIo",
        authDomain: "my-art-gallery-database.firebaseapp.com",
        projectId: "my-art-gallery-database",
        storageBucket: "my-art-gallery-database.firebasestorage.app",
        messagingSenderId: "384625725027",
        appId: "1:384625725027:web:54eeca619c79547bcdb256",
        measurementId: "G-LMPGKDWC1X"
      };
      
      // Firebase ‡∂¥‡∂ß‡∂±‡∑ä‡∂ú‡∂±‡∑ä‡∂±‡∑Ä‡∑è
      firebase.initializeApp(firebaseConfig);
      
      // ‡∂Ö‡∂¥‡∑ö "Online ‡∂¥‡∑ú‡∂≠" (database) ‡∂ë‡∂ö‡∂ß ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞ ‡∑Ä‡∑ô‡∂±‡∑Ä‡∑è
      const db = firebase.firestore(); 
    </script>
    
    <script>
        // Check if user is logged in
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>

    <script src="script.js"></script>
</body>
</html>
